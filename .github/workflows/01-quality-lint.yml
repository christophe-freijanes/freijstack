name: üîç Lint Suite ‚Ä¢ Quality Check

on:
  push:
    branches: [develop, master]
  pull_request:
    branches: [develop, master]

jobs:
  yamllint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install yamllint
        run: sudo apt-get update && sudo apt-get install -y yamllint
      - name: Run yamllint
        run: yamllint .

  bash:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install shellcheck
        run: sudo apt-get update && sudo apt-get install -y shellcheck
      - name: Run shellcheck
        run: |
          set -euo pipefail
          if ! find . -name '*.sh' -print -quit | grep -q .; then
            echo "No shell scripts to lint"
            exit 0
          fi
          find . -name '*.sh' -print0 | xargs -0 shellcheck

  python:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v6
        with:
          python-version: '3.11'
      - name: Install ruff
        run: python -m pip install --upgrade pip ruff
      - name: Run ruff
        run: ruff check .

  powershell:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install PSScriptAnalyzer
        shell: pwsh
        run: |
          Install-Module PSScriptAnalyzer -Scope CurrentUser -Force
      - name: Run PSScriptAnalyzer
        shell: pwsh
        run: |
          $files = Get-ChildItem -Recurse -Filter '*.ps1'
          if (-not $files) {
            Write-Host 'No PowerShell scripts to lint'
            exit 0
          }
          $files | ForEach-Object {
            Invoke-ScriptAnalyzer -Path $_.FullName -ErrorAction Stop
          }

  ansible:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install ansible-lint
        run: |
          python -m pip install --upgrade pip
          python -m pip install ansible ansible-lint
      - name: Run ansible-lint (if Ansible dirs present)
        run: |
          set -euo pipefail
          if ! find . -type d \( -name ansible -o -name playbooks -o -name roles \) -print -quit | grep -q .; then
            echo "No Ansible directories to lint"
            exit 0
          fi
          ansible-lint

  terraform:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v3
      - name: Install tflint
        run: curl -s https://raw.githubusercontent.com/terraform-linters/tflint/master/install_linux.sh | bash
      - name: Run terraform fmt -check (if .tf files exist)
        run: |
          set -euo pipefail
          if ! find . -name '*.tf' -print -quit | grep -q .; then
            echo "No Terraform files to lint"
            exit 0
          fi
          terraform fmt -check -recursive
      - name: Run tflint
        run: |
          set -euo pipefail
          if ! find . -name '*.tf' -print -quit | grep -q .; then
            echo "No Terraform files to lint"
            exit 0
          fi
          tflint

  markdown:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v6
        with:
          node-version: '20'
      - name: Install markdownlint-cli2
        run: npm install -g markdownlint-cli2
      - name: Run markdownlint
        run: |
          set -euo pipefail
          if ! find . -name '*.md' -print -quit | grep -q .; then
            echo "No Markdown files to lint"
            exit 0
          fi
          markdownlint-cli2 "**/*.md" "#node_modules"
